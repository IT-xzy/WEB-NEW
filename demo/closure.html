<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<style>
  body {
    font-family: Helvetica, Arial, sans-serif;
    font-size: 30px;
  }

  h1 {
    font-size: 1.5em;
  }

  h2 {
    font-size: 1.2em;
  }
</style>

<body>
  <p>词法作用域</p>
  <p>闭包</p>
  <p>使用闭包</p>
  <p>共享同一个环境的闭包</p>
  <a href="#" id="size-22">22</a>
  <a href="#" id="size-24">24</a>
  <a href="#" id="size-26">26</a>
  <p id="help">Helpful notes will appear here</p>
  <p>E-mail: <input type="text" id="email" name="email"></p>
  <p>Name: <input type="text" id="name" name="name"></p>
  <p>Age: <input type="text" id="age" name="age"></p>
</body>
<script>
  // 词法作用域
  // function init() {
  //     var name = "Mozilla"; // name 是一个被 init 创建的局部变量
  //     function displayName() { // displayName() 是内部函数,一个闭包
  //         console.log(name); // 使用了父函数中声明的变量
  //     }
  //     displayName();
  // }
  // init();
  // 典型的闭包
  // function makeFunc() {
  //     var name = "Mozilla";
  //     function displayName() {
  //         alert(name);
  //     }
  //     return displayName;
  // }
  //
  // var myFunc = makeFunc();
  // myFunc()
  //   function makeAdder(x) {
  //     return function(y) {
  //       return x + y
  //     }
  //   }
  //   var add5=makeAdder(5);
  //   var add10=makeAdder(10);
  // console.log(add5(2));
  // console.log(add10(4));
  // 闭包的用途
  // 通常你使用只有一个方法的对象的地方，都可以使用闭包
  // function makeSizer(size) {
  //   return function() {
  //     document.body.style.fontSize = size + 'px';
  //   };
  // }
  //
  // var size12 = makeSizer(22);
  // var size14 = makeSizer(24);
  // var size16 = makeSizer(26);
  // document.getElementById('size-22').onclick = size12;
  // document.getElementById('size-24').onclick = size14;
  // document.getElementById('size-26').onclick = size16;
  // var makeCounter = function() {
  //   var privateCounter = 0;
  //
  //   function changeBy(val) {
  //     privateCounter += val;
  //   }
  //   return {
  //     increment: function() {
  //       changeBy(1);
  //     },
  //     decrement: function() {
  //       changeBy(-1);
  //     },
  //     value: function() {
  //       return privateCounter;
  //     }
  //   }
  // };
  // var Counter1=makeCounter();
  // var Counter2=makeCounter();
  // console.log(Counter1.value());
  // Counter1.increment();
  // Counter1.increment();
  // console.log(Counter1.value());
  // Counter1.decrement();
  // console.log(Counter1.value());
  // console.log(Counter2.value());
  // 请注意两个计数器 counter1 和 counter2 是如何维护它们各自的独立性的。
  // 每个闭包都是引用自己词法作用域内的变量 privateCounter
  // 闭包常见问题，在循环中使用闭包
  function showHelp(help) {
    document.getElementById('help').innerHTML = help;
  }

  function makeHelpCallback(help) {
    return function() {
      showHelp(help);
    };
  }

  function setupHelp() {
    var helpText = [{
        'id': 'email',
        'help': 'Your e-mail address'
      },
      {
        'id': 'name',
        'help': 'Your full name'
      },
      {
        'id': 'age',
        'help': 'Your age (you must be over 16)'
      }
    ];
    for (var i = 0; i < helpText.length; i++) {
      // var item = helpText[i];
      // document.getElementById(item.id).onfocus = function() {
      //   showHelp(item.help);
      // }
      // document.getElementById(item.id).onfocus = makeHelpCallback(item.help);
      // (function() {
      //   var item = helpText[i];
      //   document.getElementById(item.id).onfocus = function() {
      //     showHelp(item.help)
      //   }
      // })()
      let item = helpText[i];
      document.getElementById(item.id).onfocus = function() {
        showHelp(item.help);
      }
    }
  }
  setupHelp();
</script>

</html>
